---
title: "Module 1 solutions"
format: pdf
papersize: A4
mainfont: Roboto
sansfont: Clancy
include-in-header:
  text: |
    \newfontfamily\tfont{Roboto Light}
    \usepackage[section]{placeins}
---

# Module 2: Solutions to Learning Activities

## Activity 2.4

\tfont
Using the health survey data (`Activity_S2.4.xlsx`) described in the computing notes of this module, create a new variable, BMI, which is equal to a person's weight (in kg) divided by their height (in metres) squared (i.e. $\text{BMI} = \frac{\text{weight (kg)}}{\text{[height (m)]}^2}$. Categorise BMI using the WHO categories:

-   Underweight: BMI \< 18.5
-   Normal weight: 18.5 $\le$ BMI \< 25
-   Pre-obesity: 25 $\le$ BMI \< 30
-   Obesity Class I: 30 $\le$ BMI \< 35
-   Obesity Class II: 35 $\le$ BMI \< 40
-   Obesity Class III: BMI $\ge$ 40

Create a two-way table to display the distribution of BMI categories by sex (sex: 1 = respondent identifies as male; 2 = respondent identifies as female). Does there appear to be a difference in categorised BMI between males and females?
\normalfont

### Answers

```{r, echo=FALSE}
#| tbl-cap: CAPTION
library(huxtable)

tab2_4 <- tibble::tribble(
        ~`BMI category`,         ~Male,       ~Female,         ~Total,
        "Underweight",    "6 (1.2%)",   "12 (1.9%)",    "18 (1.6%)",
      "Normal weight", "134 (26.1%)", "228 (36.4%)",  "362 (31.8%)",
        "Pre-obesity", "216 (42.1%)", "195 (31.1%)",  "411 (36.1%)",
    "Obesity Class I",  "95 (18.5%)", "106 (16.9%)",  "201 (17.6%)",
   "Obesity Class II",   "46 (9.0%)",   "55 (8.8%)",   "101 (8.9%)",
  "Obesity Class III",   "16 (3.1%)",   "31 (4.9%)",    "47 (4.1%)",
              "Total",  "513 (100.0%)",  "627 (100.0%)", "1,140 (100.0%)"
  )

huxtable::huxtable(tab2_4, add_colnames = TRUE) |>
  theme_article() |> 
  set_bold(final(1), TRUE)
```

\FloatBarrier

From this health survey, it appears that men are more likely to have BMIs indicating Pre-Obesity (men 42% vs women 31%) and Obesity Class I (men 19% vs women 17%), compared to women who are more likely to have BMIs indicating Normal weight (women 36% vs men 26%).

### Process

We first read the Excel data into R, using the readxl package. It is useful to examine the dataset - here using the `summary()` function:

```{r}
library(readxl)
library(jmv)

survey <- read_excel("data/activities/Activity_S2.4-health-survey.xlsx")
summary(survey)
```

Note that has been entered as a numeric variable. We should define sex as a factor, and then create BMI. After creating BMI, we should examine its distribution using a histogram and/or a boxplot:

```{r}
# Define sex as a factor
survey$sex <- factor(survey$sex, level=c(1,2), labels=c("Male", "Female"))

# Create BMI
survey$bmi = survey$weight / (survey$height^2)

# Examine the distribution of BMI
hist(survey$bmi, main="Histogram of BMI", xlab="Body mass index (kg/m2)")
boxplot(survey$bmi, main="Boxplot of BMI", ylab="Body mass index (kg/m2)")
```

The boxplot in particular shows that there are some extreme values of BMI. We can examine some records using the `subset()` function:

```{r}
subset(survey, bmi<15)

subset(survey, bmi>45)
```

\FloatBarrier

The smallest BMI of 9.2 kg/m2 is very low, with a weight of 22.7 kg. We should check the recorded height and weight values against the original data (paper records, survey responses) if they were available. However, as a weight of 22.7kg is not impossible, this record will not be deleted. An alternative approach would be to analyse the data including the very low BMI and again excluding the very low BMI as a sensitivity analysis.

The largest BMI values are based on participants with large weights, and none of these seem biologically implausible. Therefore, no changes will be made to participants with small or large values of BMI.

We can use the `cut()` function to create the BMI categories. The WHO cutpoints are inclusive of the lower-bound, so we use right=FALSE. After creating the categories, it is good practice to check the resulting categories using `summary()`:

```{r}
survey$bmi_cat <- cut(survey$bmi, c(0, 18.5, 25, 30, 35, 40, 100), right=FALSE)
summary(survey$bmi_cat)
```

Finally, we can create a two-way table using the contTables() function within the jmv package. We can define the rows by BMI category, and the columns by sex:

```{r}
contTables(data=survey,
           rows = bmi_cat,
           cols = sex)
```

To assess whether there is a difference in BMI between males and females, we should look at the within-sex relative frequencies. In other words, column percents (for this table), by specifying pcCol = TRUE:

```{r}
contTables(data=survey,
           rows = bmi_cat,
           cols = sex,
           pcCol = TRUE)
```
